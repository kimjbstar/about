<!DOCTYPE html><html lang="en"><title>Next.JS + TailwindCSS</title><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="icon" href="/favicon.ico"/><link rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/602c9aeee430ea41.css" as="style"/><link rel="stylesheet" href="/_next/static/css/602c9aeee430ea41.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-38cee4c0e358b1a3.js" defer=""></script><script src="/_next/static/chunks/framework-73b8966a3c579ab0.js" defer=""></script><script src="/_next/static/chunks/main-38ead3c0359836e3.js" defer=""></script><script src="/_next/static/chunks/pages/_app-8da71599b066680e.js" defer=""></script><script src="/_next/static/chunks/0f4ba5df-f4fef96fbe8038cd.js" defer=""></script><script src="/_next/static/chunks/664-71f85c7425211588.js" defer=""></script><script src="/_next/static/chunks/556-974ba8e86a8c1b84.js" defer=""></script><script src="/_next/static/chunks/pages/blog/%5Bid%5D-93c70fb44ca1f648.js" defer=""></script><script src="/_next/static/sDNbZE89o9LIbwiabTfny/_buildManifest.js" defer=""></script><script src="/_next/static/sDNbZE89o9LIbwiabTfny/_ssgManifest.js" defer=""></script></head><body><div id="__next"><main class="__className_f62174"><nav class="text-s flex justify-center border-b-2 border-gray-100"><div class="flex justify-around max-w-[1200px] w-full"><div class="p-6"><a href="/about">About</a></div><div class="p-6"><a href="/blog">Blog</a></div><div class="p-6"><a href="/other">Other</a></div></div></nav><section class="flex flex-col items-center mt-20"><div class="max-w-7xl flex flex-col"><div class="text-6xl mb-10 font-bold text-gray-800">prisma-class-generator 제작 및 배포기</div><div class="text-4xl mb-10 text-gray-700"></div><div class="self-end">2021-10-08T08:25:47+00:00</div><div class="markdown-body"><h3>개요 - NestJS와 Prisma의 궁합은 어떤가?</h3>
<p><img src="https://pihxnuyialxsmkzxlpjj.supabase.co/storage/v1/object/public/bucket01/pcg01.jpeg" alt=""/></p>
<p><img src="https://pihxnuyialxsmkzxlpjj.supabase.co/storage/v1/object/public/bucket01/pcg02.jpeg" alt=""/></p>
<p>기존의 TypeORM에서 Prisma로 마이그레이션 하면서 걸렸던 점이 하나 있는데,</p>
<p>TypeORM 같은 경우는 entity class를 정의하기 때문에 이 class 혹은 field에 decorator를 추가하여 자연스럽게 NestJS랑 핏이 잘 맞게 됩니다.</p>
<p>반면에 Prisma는 기본적으로 schema.prisma에 정의된 모델을 single source of truth를 기반으로 타입들을 생성하기 때문에 엔티티 클래스를 별도로 정의할 필요가 없습니다.</p>
<p>그렇기 때문에 NestJS, 특히 swagger 등을 사용할 때는 DTO, response등을 class로 각각 정의해야 할 필요성이 있을 수도 있습니다.</p>
<h3>작업</h3>
<p>처음 이러한 기능의 필요성을 느껴 리서치를 해보니 prismaClient에서 dmmf란 Object를 얻을 수 있는데 이를 이용하여 prisma.schema의 메타데이터를 파싱하여 클래스를 생성해주는 Function을 export하여 제공했습니다.</p>
<pre><div class="code-style" style="color:#f8f8f2;background:#272822;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em"><code class="language-typescript" style="color:#f8f8f2;background:none;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token module" style="color:#66d9ef">import</span><span> </span><span class="token imports" style="color:#f8f8f2">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">PrismaClient</span><span class="token imports"> </span><span class="token imports" style="color:#f8f8f2">}</span><span> </span><span class="token module" style="color:#66d9ef">from</span><span> </span><span class="token" style="color:#a6e22e">&#x27;@prisma/client&#x27;</span><span>
</span><span></span><span class="token module" style="color:#66d9ef">import</span><span> </span><span class="token imports" style="color:#f8f8f2">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">DMMFClass</span><span class="token imports"> </span><span class="token imports" style="color:#f8f8f2">}</span><span> </span><span class="token module" style="color:#66d9ef">from</span><span> </span><span class="token" style="color:#a6e22e">&#x27;@prisma/client/runtime&#x27;</span><span>
</span><span></span><span class="token module" style="color:#66d9ef">import</span><span> </span><span class="token imports" style="color:#f8f8f2">{</span><span class="token imports"> writeFromDMMF </span><span class="token imports" style="color:#f8f8f2">}</span><span> </span><span class="token module" style="color:#66d9ef">from</span><span> </span><span class="token" style="color:#a6e22e">&#x27;prisma-class-generator&#x27;</span><span>
</span>
<span></span><span class="token" style="color:#8292a2">// @ts-ignore</span><span>
</span><span></span><span class="token" style="color:#66d9ef">const</span><span> dmmf</span><span class="token" style="color:#f8f8f2">:</span><span> </span><span class="token maybe-class-name">DMMFClass</span><span> </span><span class="token" style="color:#f8f8f2">=</span><span> </span><span class="token" style="color:#66d9ef">new</span><span> </span><span class="token maybe-class-name" style="color:#e6db74">PrismaClient</span><span class="token" style="color:#f8f8f2">(</span><span class="token" style="color:#f8f8f2">)</span><span class="token" style="color:#f8f8f2">.</span><span class="token property-access">_dmmf</span><span>
</span>
<span></span><span class="token" style="color:#e6db74">writeFromDMMF</span><span class="token" style="color:#f8f8f2">(</span><span class="token" style="color:#f8f8f2">{</span><span>
</span><span>	dmmf</span><span class="token" style="color:#f8f8f2">:</span><span> dmmf </span><span class="token module" style="color:#66d9ef">as</span><span> </span><span class="token" style="color:#a6e22e">any</span><span class="token" style="color:#f8f8f2">,</span><span>
</span><span>	outputType</span><span class="token" style="color:#f8f8f2">:</span><span> </span><span class="token" style="color:#a6e22e">&#x27;file&#x27;</span><span class="token" style="color:#f8f8f2">,</span><span>
</span><span>	targetDir</span><span class="token" style="color:#f8f8f2">:</span><span> </span><span class="token" style="color:#f8f8f2">&lt;</span><span class="token" style="color:#f92672">PATH</span><span> </span><span class="token" style="color:#f92672">DIRECTORY</span><span> </span><span class="token" style="color:#f92672">TO</span><span> </span><span class="token" style="color:#f92672">WRITE</span><span> </span><span class="token" style="color:#f92672">RESULT</span><span> </span><span class="token" style="color:#f92672">CLASSES</span><span class="token" style="color:#f8f8f2">&gt;</span><span class="token" style="color:#f8f8f2">,</span><span>
</span><span>	useSwagger</span><span class="token" style="color:#f8f8f2">:</span><span> </span><span class="token" style="color:#ae81ff">true</span><span class="token" style="color:#f8f8f2">,</span><span>
</span><span></span><span class="token" style="color:#f8f8f2">}</span><span class="token" style="color:#f8f8f2">)</span></code></div></pre>
<p>추후 슬랙에서 비슷한 라이브러리를 보니 이런 방식이 아닌 추가적인 generator를 배포하는 방식이었습니다. 사실 공식문서에서 커스텀 generator를 사용할 수 있게 제공했는데 제가 이 부분을 체크하지 못하였기 때문에 이러한 방식으로 작업한 것이였습니다.</p>
<p><a href="https://www.prisma.io/docs/concepts/components/prisma-schema/generators">Generators (Reference)</a></p>
<p>다행히 더 좋은 방식 및 인사이트를 얻었으니 이 방식으로 전면 리팩토링했습니다.</p>
<p><a href="https://github.com/kimjbstar/prisma-class-generator">GitHub - kimjbstar/prisma-class-generator: Class generator from Prisma schema</a></p>
<p><img src="https://pihxnuyialxsmkzxlpjj.supabase.co/storage/v1/object/public/bucket01/pcg03.png" alt=""/></p>
<h3>고민사항</h3>
<p>어느정도 기본적인 기능은 만들었다 싶어 홍보를 위해 prisma 공식 slack을 체크해 보았는데 <strong>#nest-generator</strong>라는 채널이 이미 있었고, 비슷한 기능을 하는 라이브러리가 두어개 정도 존재했습니다.</p>
<p><img src="https://pihxnuyialxsmkzxlpjj.supabase.co/storage/v1/object/public/bucket01/pcg04.png" alt=""/></p>
<p>그래서 든 고민은 이미 이러한 라이브러리들이 있는데 제가 추가하여 비슷한 기능을 가진 라이브러리를 파편화 시키는 것 아닌가? 라는 고민이 들었습니다. 그래서 이 라이브러리 개발에 합류하여 같이 고도화시키는게 어떤가 라는 생각도 했습니다.</p>
<p>하지만 고민해본 결과 그런 고민을 할정도로 다른 라이브러리들이 고도화되어 있지 않았고, 제 플랜에는 오히려 기존에 파편화된 라이브러리 기능들을 통합할 계획도 있기 때문에 기존 방향대로 진행하기로 마음 먹었습니다.</p>
<pre><code>커뮤니티, 슬랙 등 기존 존재하는 generator 프로젝트들 리서치

class, DTO 관련
- prisma-generator-nestjs-dto
- prisma-nestjs-dto-generator

graphQL 관련
- typegraphql-prisma
- prisma-nestjs-graphql

-&gt; prisma-class-generator는 이 모두를 통합하여 지원하는 것이 최종 목표!
</code></pre>
<h3>배포</h3>
<p>우선 한글로 되어 있는 README.md를 전부 영어로 교체하고, 소개 및 예제를 추가했습니다.</p>
<p>만약 이 라이브러리를 홍보한다면 생각할수 있는 채널은 이정도가 있다고 정리했습니다.</p>
<ul>
<li>Nestjs 오픈채팅방</li>
<li>prisma slack</li>
<li>NestJS discord</li>
<li>prisma doc</li>
</ul>
<h3>공식 문서에 추가 - prisma doc에 PR</h3>
<p>위 generator 문서를 보면 community generator(비공식) 목록이 있는데, 제 라이브러리를 여기에 올리고 싶었습니다. 처음에는 슬랙 등 커뮤니티를 통해 코어 컨트리뷰터 등 한테 어필(?)을 하여 추가되는 줄 알았는데, prisma 문서 프로젝트에 직접 PR을 보내 반영되는 방식이었습니다. 코드리뷰와 프로젝트 체크도 이 때 진행되는 것으로 보입니다.</p>
<p><strong>과정</strong></p>
<ul>
<li>우선 프로젝트를 fork받아 해당 페이지를 수정 후 PR 요청을 해보았습니다. 생각보다 빠르게 코드리뷰가 진행되었고, edit suggestion이 담긴 답글이 달려, 수정 반영 후 기다리자 곧 merge가 되었습니다.</li>
</ul>
<p><a href="https://github.com/prisma/docs/pull/2390">add prisma-class-generator to community generators by kimjbstar · Pull Request #2390 · prisma/docs</a></p>
<p><img src="https://pihxnuyialxsmkzxlpjj.supabase.co/storage/v1/object/public/bucket01/pcg05.png" alt=""/></p>
<p><img src="https://pihxnuyialxsmkzxlpjj.supabase.co/storage/v1/object/public/bucket01/pcg06.png" alt=""/></p>
<ul>
<li>또한 제 라이브러리의 README.md 수정 PR도 요청해주셔서 바로 반영했습니다. 😄</li>
</ul>
<p><img src="https://pihxnuyialxsmkzxlpjj.supabase.co/storage/v1/object/public/bucket01/pcg07.png" alt=""/></p>
<p><img src="https://pihxnuyialxsmkzxlpjj.supabase.co/storage/v1/object/public/bucket01/pcg08.png" alt=""/></p>
<p><a href="https://github.com/kimjbstar/prisma-class-generator/pull/1">docs(README): Small fixes by janpio · Pull Request #1 · kimjbstar/prisma-class-generator</a></p>
<h3>결론</h3>
<ul>
<li>
<p>sequelize-typescript-migration을 만들었을 때는 소위 홍보도 하지 않고 방치시켰다면, 이번 같은 경우 여러 채널을 통해 홍보 예정이고 Prisma 프로젝트 자체도 개발이 활발하게 이루어지기 때문에 소위 보는 눈(?)이 더 많을 것으로 보입니다. 그렇기 때문에 더 책임감을 느끼고 개발해야 한다는 마음가짐이 더 큽니다.</p>
</li>
<li>
<p>Pull Request가 <a href="http://README.md">README.md</a> 쪽이 아닌 로직 수정 관련하여 요청이 들어올 수도 있으니 테스트 및 배포 자동화의 우선순위도 높을 것으로 보입니다.</p>
</li>
<li>
<p>마지막으로 영어 공부의 필요성을 많이 느꼈습니다. PR을 보냈을때는 리뷰가 빠르고 반영이 빨라 놀라웠지만, 동시에 부끄러움도 느꼈습니다. 코드 쪽에만 신경썼지 README 및 가이드 쪽 영어에는 신경을 크게 쓰지 못해 오탈자 및 영어 문법쪽에서 수정소요가 추가로 있었기 때문입니다. 앞으로 오픈소스 등을 작업하면 영어로 소통하는 것이 기본일텐데, 더욱 영어와 친숙해지도록 노력을 해야 할 것으로 보입니다.</p>
</li>
</ul></div></div></section></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"blog":{"id":"7474394c-4ec3-4447-8e31-6933fa886846","title":"prisma-class-generator 제작 및 배포기","content":"### 개요 - NestJS와 Prisma의 궁합은 어떤가?\n\n![](https://pihxnuyialxsmkzxlpjj.supabase.co/storage/v1/object/public/bucket01/pcg01.jpeg)\n\n![](https://pihxnuyialxsmkzxlpjj.supabase.co/storage/v1/object/public/bucket01/pcg02.jpeg)\n\n기존의 TypeORM에서 Prisma로 마이그레이션 하면서 걸렸던 점이 하나 있는데,\n\nTypeORM 같은 경우는 entity class를 정의하기 때문에 이 class 혹은 field에 decorator를 추가하여 자연스럽게 NestJS랑 핏이 잘 맞게 됩니다.\n\n반면에 Prisma는 기본적으로 schema.prisma에 정의된 모델을 single source of truth를 기반으로 타입들을 생성하기 때문에 엔티티 클래스를 별도로 정의할 필요가 없습니다.\n\n그렇기 때문에 NestJS, 특히 swagger 등을 사용할 때는 DTO, response등을 class로 각각 정의해야 할 필요성이 있을 수도 있습니다.\n\n### 작업\n\n처음 이러한 기능의 필요성을 느껴 리서치를 해보니 prismaClient에서 dmmf란 Object를 얻을 수 있는데 이를 이용하여 prisma.schema의 메타데이터를 파싱하여 클래스를 생성해주는 Function을 export하여 제공했습니다.\n\n```typescript\nimport { PrismaClient } from '@prisma/client'\nimport { DMMFClass } from '@prisma/client/runtime'\nimport { writeFromDMMF } from 'prisma-class-generator'\n\n// @ts-ignore\nconst dmmf: DMMFClass = new PrismaClient()._dmmf\n\nwriteFromDMMF({\n\tdmmf: dmmf as any,\n\toutputType: 'file',\n\ttargetDir: \u003cPATH DIRECTORY TO WRITE RESULT CLASSES\u003e,\n\tuseSwagger: true,\n})\n```\n\n추후 슬랙에서 비슷한 라이브러리를 보니 이런 방식이 아닌 추가적인 generator를 배포하는 방식이었습니다. 사실 공식문서에서 커스텀 generator를 사용할 수 있게 제공했는데 제가 이 부분을 체크하지 못하였기 때문에 이러한 방식으로 작업한 것이였습니다.\n\n[Generators (Reference)](https://www.prisma.io/docs/concepts/components/prisma-schema/generators)\n\n다행히 더 좋은 방식 및 인사이트를 얻었으니 이 방식으로 전면 리팩토링했습니다.\n\n[GitHub - kimjbstar/prisma-class-generator: Class generator from Prisma schema](https://github.com/kimjbstar/prisma-class-generator)\n\n![](https://pihxnuyialxsmkzxlpjj.supabase.co/storage/v1/object/public/bucket01/pcg03.png)\n\n### 고민사항\n\n어느정도 기본적인 기능은 만들었다 싶어 홍보를 위해 prisma 공식 slack을 체크해 보았는데 **#nest-generator**라는 채널이 이미 있었고, 비슷한 기능을 하는 라이브러리가 두어개 정도 존재했습니다.\n\n![](https://pihxnuyialxsmkzxlpjj.supabase.co/storage/v1/object/public/bucket01/pcg04.png)\n\n그래서 든 고민은 이미 이러한 라이브러리들이 있는데 제가 추가하여 비슷한 기능을 가진 라이브러리를 파편화 시키는 것 아닌가? 라는 고민이 들었습니다. 그래서 이 라이브러리 개발에 합류하여 같이 고도화시키는게 어떤가 라는 생각도 했습니다.\n\n하지만 고민해본 결과 그런 고민을 할정도로 다른 라이브러리들이 고도화되어 있지 않았고, 제 플랜에는 오히려 기존에 파편화된 라이브러리 기능들을 통합할 계획도 있기 때문에 기존 방향대로 진행하기로 마음 먹었습니다.\n\n```\n커뮤니티, 슬랙 등 기존 존재하는 generator 프로젝트들 리서치\n\nclass, DTO 관련\n- prisma-generator-nestjs-dto\n- prisma-nestjs-dto-generator\n\ngraphQL 관련\n- typegraphql-prisma\n- prisma-nestjs-graphql\n\n-\u003e prisma-class-generator는 이 모두를 통합하여 지원하는 것이 최종 목표!\n```\n\n### 배포\n\n우선 한글로 되어 있는 README.md를 전부 영어로 교체하고, 소개 및 예제를 추가했습니다.\n\n만약 이 라이브러리를 홍보한다면 생각할수 있는 채널은 이정도가 있다고 정리했습니다.\n\n- Nestjs 오픈채팅방\n- prisma slack\n- NestJS discord\n- prisma doc\n\n### 공식 문서에 추가 - prisma doc에 PR\n\n위 generator 문서를 보면 community generator(비공식) 목록이 있는데, 제 라이브러리를 여기에 올리고 싶었습니다. 처음에는 슬랙 등 커뮤니티를 통해 코어 컨트리뷰터 등 한테 어필(?)을 하여 추가되는 줄 알았는데, prisma 문서 프로젝트에 직접 PR을 보내 반영되는 방식이었습니다. 코드리뷰와 프로젝트 체크도 이 때 진행되는 것으로 보입니다.\n\n**과정**\n\n- 우선 프로젝트를 fork받아 해당 페이지를 수정 후 PR 요청을 해보았습니다. 생각보다 빠르게 코드리뷰가 진행되었고, edit suggestion이 담긴 답글이 달려, 수정 반영 후 기다리자 곧 merge가 되었습니다.\n    \n[add prisma-class-generator to community generators by kimjbstar · Pull Request #2390 · prisma/docs](https://github.com/prisma/docs/pull/2390)\n    \n![](https://pihxnuyialxsmkzxlpjj.supabase.co/storage/v1/object/public/bucket01/pcg05.png)\n    \n![](https://pihxnuyialxsmkzxlpjj.supabase.co/storage/v1/object/public/bucket01/pcg06.png)\n    \n- 또한 제 라이브러리의 README.md 수정 PR도 요청해주셔서 바로 반영했습니다. 😄\n    \n![](https://pihxnuyialxsmkzxlpjj.supabase.co/storage/v1/object/public/bucket01/pcg07.png)\n    \n![](https://pihxnuyialxsmkzxlpjj.supabase.co/storage/v1/object/public/bucket01/pcg08.png)\n    \n[docs(README): Small fixes by janpio · Pull Request #1 · kimjbstar/prisma-class-generator](https://github.com/kimjbstar/prisma-class-generator/pull/1)\n    \n\n### 결론\n\n- sequelize-typescript-migration을 만들었을 때는 소위 홍보도 하지 않고 방치시켰다면, 이번 같은 경우 여러 채널을 통해 홍보 예정이고 Prisma 프로젝트 자체도 개발이 활발하게 이루어지기 때문에 소위 보는 눈(?)이 더 많을 것으로 보입니다. 그렇기 때문에 더 책임감을 느끼고 개발해야 한다는 마음가짐이 더 큽니다.\n\n- Pull Request가 [README.md](http://README.md) 쪽이 아닌 로직 수정 관련하여 요청이 들어올 수도 있으니 테스트 및 배포 자동화의 우선순위도 높을 것으로 보입니다.\n\n- 마지막으로 영어 공부의 필요성을 많이 느꼈습니다. PR을 보냈을때는 리뷰가 빠르고 반영이 빨라 놀라웠지만, 동시에 부끄러움도 느꼈습니다. 코드 쪽에만 신경썼지 README 및 가이드 쪽 영어에는 신경을 크게 쓰지 못해 오탈자 및 영어 문법쪽에서 수정소요가 추가로 있었기 때문입니다. 앞으로 오픈소스 등을 작업하면 영어로 소통하는 것이 기본일텐데, 더욱 영어와 친숙해지도록 노력을 해야 할 것으로 보입니다.","created_at":"2021-10-08T08:25:47+00:00","subtitle":null,"is_show":true}},"__N_SSG":true},"page":"/blog/[id]","query":{"id":"7474394c-4ec3-4447-8e31-6933fa886846"},"buildId":"sDNbZE89o9LIbwiabTfny","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>